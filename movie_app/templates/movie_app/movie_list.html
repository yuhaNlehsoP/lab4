{% extends 'movie_app/base.html' %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card text-center">
            <div class="card-body">
                <h2 class="card-title">
                    {% if request.GET.source == 'file' %}
                    <i class="bi bi-file-earmark-text"></i> КИНОТЕКА ИЗ ФАЙЛОВ
                    {% else %}
                    <i class="bi bi-database"></i> КИНОТЕКА ИЗ БАЗЫ ДАННЫХ
                    {% endif %}
                </h2>
                <p class="text-muted">COLLECTION OF BRUTAL CINEMA</p>

                <!-- AJAX поиск только для базы данных -->
                {% if request.GET.source != 'file' %}
                <div class="mt-3" style="max-width: 500px; margin: 0 auto;">
                    <input type="text" id="search-input"
                           placeholder="🔍 Поиск по названию, режиссеру, жанру..."
                           class="form-control form-control-lg"
                           value="{{ search_query }}">
                    <div id="search-results" class="search-results mt-2"></div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% for movie in movies %}
<div class="card movie-card mb-4">
    <div class="card-body">
        <div class="row">
            <div class="col-md-9">
                <h3 class="card-title text-primary">{{ movie.title }}</h3>
                <h6 class="card-subtitle mb-2 text-muted">
                    <i class="bi bi-camera-reels"></i> Режиссер: {{ movie.director }}
                </h6>

                <div class="mb-3">
                    <span class="badge bg-secondary">{{ movie.year }} ГОД</span>
                    <span class="badge bg-info text-dark">{{ movie.genre }}</span>
                    <span class="badge bg-warning text-dark">{{ movie.duration }} MIN</span>
                    <span class="badge bg-success">{{ movie.rating }}/10</span>

                    {% if request.GET.source == 'file' %}
                    <span class="badge bg-dark source-badge">ИСТОЧНИК: ФАЙЛ</span>
                    {% else %}
                    <span class="badge bg-dark source-badge">БАЗА ДАННЫХ</span>
                    {% endif %}
                </div>

                <div class="mb-2">
                    <strong><i class="bi bi-people"></i> В ролях:</strong><br>
                    {{ movie.cast }}
                </div>

                <div class="mb-3">
                    <strong><i class="bi bi-card-text"></i> Описание:</strong><br>
                    {{ movie.description }}
                </div>

                {% if movie.image_url %}
                <div class="mb-3">
                    <img src="{{ movie.image_url }}" alt="{{ movie.title }}"
                         class="img-fluid rounded" style="max-height: 300px;">
                </div>
                {% endif %}

                {% if request.GET.source != 'file' %}
                <small class="text-muted">
                    <i class="bi bi-clock"></i> Добавлен: {{ movie.created_at|date:"d.m.Y H:i" }}
                </small>
                {% endif %}
            </div>

            <!-- Кнопки управления только для базы данных -->
            {% if request.GET.source != 'file' %}
            <div class="col-md-3">
                <div class="d-grid gap-2">
                    <a href="{% url 'movie_app:edit_movie' movie.id %}"
                       class="btn btn-warning btn-sm">
                        <i class="bi bi-pencil"></i> Редактировать
                    </a>
                    <a href="{% url 'movie_app:delete_movie' movie.id %}"
                       class="btn btn-danger btn-sm">
                        <i class="bi bi-trash"></i> Удалить
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% empty %}
<div class="card text-center">
    <div class="card-body py-5">
        <h3 class="text-muted">Фильмов нет</h3>
        <p class="text-muted">Коллекция пуста. Добавьте первый фильм!</p>
        <a href="{% url 'movie_app:add_movie' %}" class="btn btn-primary btn-lg">
            <i class="bi bi-plus-circle"></i> Добавить первый фильм
        </a>
    </div>
</div>
{% endfor %}
{% endblock %}